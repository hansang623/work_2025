<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>çˆ¶çˆ±è·³ä¸€è·³ - çˆ¶äº²èŠ‚ç‰¹åˆ«ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #gameCanvas {
            background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 100%);
            border: 3px solid #fff;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 100%;
            max-height: 100%;
        }

        #gameUI {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .ui-panel {
            background: rgba(255,255,255,0.9);
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-weight: bold;
            color: #333;
        }

        #instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            text-align: center;
            font-size: 14px;
            z-index: 100;
        }

        #powerBar {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 200px;
            background: rgba(255,255,255,0.3);
            border: 2px solid #fff;
            border-radius: 10px;
            z-index: 100;
            display: none;
        }

        #powerFill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, #ff4444, #ffff44, #44ff44);
            border-radius: 8px;
            transition: height 0.1s ease;
        }

        .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            color: white;
            text-align: center;
        }

        .restart-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s ease;
        }

        .restart-btn:hover {
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            #gameUI {
                top: 10px;
                left: 10px;
                right: 10px;
            }
            
            .ui-panel {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            #instructions {
                bottom: 10px;
                padding: 10px 20px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameUI">
            <div class="ui-panel">
                <span>åˆ†æ•°: </span><span id="score">0</span>
            </div>
            <div class="ui-panel">
                <span>æœ€é«˜åˆ†: </span><span id="highScore">0</span>
            </div>
            <div class="ui-panel" id="statusPanel">
                <span id="gameStatus">ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ çˆ¶å­åŒè¡Œ</span>
            </div>
        </div>

        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <div id="powerBar">
            <div id="powerFill"></div>
        </div>

        <div id="instructions">
            <div>ğŸ® é•¿æŒ‰å±å¹•è“„åŠ›è·³è·ƒ | æ¾å¼€é‡Šæ”¾</div>
            <div>ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ çˆ¶äº²ä¿æŠ¤å­©å­ï¼Œå¤±è´¥åå­©å­ç‹¬è‡ªå‰è¡Œ</div>
        </div>

        <div id="gameOverScreen" class="game-over-screen">
            <h2 id="gameOverTitle">æ¸¸æˆç»“æŸ</h2>
            <p id="gameOverMessage"></p>
            <p>æœ€ç»ˆåˆ†æ•°: <span id="finalScore">0</span></p>
            <button class="restart-btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <script>
        /**
         * çˆ¶çˆ±è·³ä¸€è·³æ¸¸æˆ - æ ¸å¿ƒæ¸¸æˆå¼•æ“
         * å®ç°ç±»ä¼¼å¾®ä¿¡è·³ä¸€è·³çš„æ¸¸æˆæœºåˆ¶ï¼Œèå…¥çˆ¶äº²èŠ‚ä¸»é¢˜
         */

        // æ¸¸æˆé…ç½®å¸¸é‡
        const GAME_CONFIG = {
            CANVAS_WIDTH: 800,
            CANVAS_HEIGHT: 600,
            PLATFORM_WIDTH: 80,
            PLATFORM_HEIGHT: 20,
            MIN_PLATFORM_DISTANCE: 100,
            MAX_PLATFORM_DISTANCE: 200,
            GRAVITY: 0.8,
            MAX_JUMP_POWER: 25,
            POWER_CHARGE_SPEED: 0.5,
            FATHER_ALIVE_DISTANCE_MULTIPLIER: 1.0,
            FATHER_DEAD_DISTANCE_MULTIPLIER: 1.5
        };

        // æ¸¸æˆçŠ¶æ€ç®¡ç†ç±»
        class GameState {
            constructor() {
                this.score = 0;
                this.highScore = parseInt(localStorage.getItem('fatherJumpHighScore') || '0');
                this.fatherAlive = true;
                this.gameRunning = false;
                this.charging = false;
                this.jumpPower = 0;
                this.currentJumper = 'father';
            }

            /**
             * æ›´æ–°åˆ†æ•°å¹¶æ£€æŸ¥æœ€é«˜åˆ†è®°å½•
             * @param {number} points - è¦å¢åŠ çš„åˆ†æ•°
             */
            addScore(points) {
                this.score += points;
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    localStorage.setItem('fatherJumpHighScore', this.highScore.toString());
                }
                this.updateUI();
            }

            /**
             * æ›´æ–°æ¸¸æˆUIæ˜¾ç¤º
             */
            updateUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('highScore').textContent = this.highScore;
                
                const statusPanel = document.getElementById('gameStatus');
                if (this.fatherAlive) {
                    statusPanel.innerHTML = 'ğŸ‘¨â€ğŸ‘§â€ğŸ‘¦ çˆ¶å­åŒè¡Œ';
                    statusPanel.style.background = 'rgba(76, 175, 80, 0.9)';
                } else {
                    statusPanel.innerHTML = 'ğŸ‘§ å­©å­ç‹¬è¡Œ';
                    statusPanel.style.background = 'rgba(255, 152, 0, 0.9)';
                }
            }

            /**
             * çˆ¶äº²æ­»äº¡å¤„ç†
             */
            fatherDies() {
                this.fatherAlive = false;
                this.currentJumper = 'child';
                this.updateUI();
            }

            /**
             * é‡ç½®æ¸¸æˆçŠ¶æ€
             */
            reset() {
                this.score = 0;
                this.fatherAlive = true;
                this.gameRunning = true;
                this.charging = false;
                this.jumpPower = 0;
                this.currentJumper = 'father';
                this.updateUI();
            }
        }

        // è§’è‰²åŸºç±»
        class Character {
            constructor(x, y, color, size) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.size = size;
                this.velocityX = 0;
                this.velocityY = 0;
                this.isJumping = false;
                this.onGround = false;
            }

            /**
             * æ›´æ–°è§’è‰²ç‰©ç†çŠ¶æ€
             */
            update() {
                if (!this.onGround) {
                    this.velocityY += GAME_CONFIG.GRAVITY;
                }
                this.x += this.velocityX;
                this.y += this.velocityY;
            }

            /**
             * æ‰§è¡Œè·³è·ƒåŠ¨ä½œ
             * @param {number} power - è·³è·ƒåŠ›åº¦
             */
            jump(power) {
                if (this.onGround) {
                    this.velocityX = power * 0.8;
                    this.velocityY = -power * 0.6;
                    this.isJumping = true;
                    this.onGround = false;
                }
            }
        }

        // çˆ¶äº²è§’è‰²ç±»
        class Father extends Character {
            constructor(x, y) {
                super(x, y, '#2196F3', 30);
                this.alive = true;
            }

            /**
             * æ¸²æŸ“çˆ¶äº²è§’è‰² - çœŸäººåŒ–è®¾è®¡
             * @param {CanvasRenderingContext2D} ctx - ç”»å¸ƒä¸Šä¸‹æ–‡
             */
            render(ctx) {
                const centerX = this.x;
                const centerY = this.y - this.size/2;

                if (this.alive) {
                    // èº«ä½“ï¼ˆè¥¿è£…ï¼‰
                    ctx.fillStyle = '#1565C0';
                    ctx.fillRect(centerX - 12, centerY - 5, 24, 35);
                    
                    // é¢†å¸¦
                    ctx.fillStyle = '#D32F2F';
                    ctx.fillRect(centerX - 3, centerY - 5, 6, 25);
                    
                    // å¤´éƒ¨
                    ctx.fillStyle = '#FFDBCB';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY - 20, 12, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å¤´å‘
                    ctx.fillStyle = '#4A4A4A';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY - 25, 10, Math.PI, Math.PI * 2);
                    ctx.fill();
                    
                    // çœ¼ç›
                    ctx.fillStyle = '#000';
                    ctx.fillRect(centerX - 6, centerY - 23, 3, 2);
                    ctx.fillRect(centerX + 3, centerY - 23, 3, 2);
                    
                    // å¾®ç¬‘
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY - 18, 4, 0, Math.PI);
                    ctx.stroke();
                    
                    // æ‰‹è‡‚
                    ctx.fillStyle = '#1565C0';
                    ctx.fillRect(centerX - 18, centerY - 2, 6, 20);
                    ctx.fillRect(centerX + 12, centerY - 2, 6, 20);
                    
                    // è…¿éƒ¨
                    ctx.fillStyle = '#424242';
                    ctx.fillRect(centerX - 8, centerY + 30, 6, 20);
                    ctx.fillRect(centerX + 2, centerY + 30, 6, 20);
                    
                    // é‹å­
                    ctx.fillStyle = '#000';
                    ctx.fillRect(centerX - 10, centerY + 48, 10, 6);
                    ctx.fillRect(centerX, centerY + 48, 10, 6);
                } else {
                    // æ­»äº¡çŠ¶æ€ - ç°è‰² + æ ‡è®°
                    ctx.fillStyle = '#757575';
                    ctx.fillRect(centerX - 12, centerY - 5, 24, 35);
                    
                    // å¤´éƒ¨ï¼ˆç°è‰²ï¼‰
                    ctx.fillStyle = '#BDBDBD';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY - 20, 12, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Xçœ¼ç›
                    ctx.strokeStyle = '#F44336';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(centerX - 8, centerY - 25);
                    ctx.lineTo(centerX - 2, centerY - 19);
                    ctx.moveTo(centerX - 2, centerY - 25);
                    ctx.lineTo(centerX - 8, centerY - 19);
                    ctx.moveTo(centerX + 2, centerY - 25);
                    ctx.lineTo(centerX + 8, centerY - 19);
                    ctx.moveTo(centerX + 8, centerY - 25);
                    ctx.lineTo(centerX + 2, centerY - 19);
                    ctx.stroke();
                    
                    // éª·é«…æ ‡è¯†
                    ctx.font = '16px Arial';
                    ctx.fillStyle = '#F44336';
                    ctx.textAlign = 'center';
                    ctx.fillText('ğŸ’€', centerX, centerY - 35);
                }
            }

            /**
             * çˆ¶äº²æ­»äº¡
             */
            die() {
                this.alive = false;
                this.velocityX = 0;
                this.velocityY = 0;
            }
        }

        // å­©å­è§’è‰²ç±»
        class Child extends Character {
            constructor(x, y) {
                super(x, y, '#E91E63', 25);
                this.fearLevel = 0;
                this.maxFear = 100;
            }

            /**
             * æ¸²æŸ“å­©å­è§’è‰² - çœŸäººåŒ–è®¾è®¡
             * @param {CanvasRenderingContext2D} ctx - ç”»å¸ƒä¸Šä¸‹æ–‡
             */
            render(ctx) {
                const centerX = this.x;
                const centerY = this.y - this.size/2;
                const isAfraid = this.fearLevel > 30;

                // èº«ä½“ï¼ˆå¯çˆ±æœè£…ï¼‰
                ctx.fillStyle = '#E91E63';
                ctx.fillRect(centerX - 10, centerY, 20, 30);
                
                // å°èŠ±æœµè£…é¥°
                ctx.fillStyle = '#FFC107';
                ctx.beginPath();
                ctx.arc(centerX - 6, centerY + 5, 2, 0, Math.PI * 2);
                ctx.arc(centerX + 6, centerY + 5, 2, 0, Math.PI * 2);
                ctx.fill();
                
                // å¤´éƒ¨
                ctx.fillStyle = '#FFDBCB';
                ctx.beginPath();
                ctx.arc(centerX, centerY - 15, 10, 0, Math.PI * 2);
                ctx.fill();
                
                // å¤´å‘ï¼ˆæ£•è‰²å°è¾«å­ï¼‰
                ctx.fillStyle = '#8D6E63';
                ctx.beginPath();
                ctx.arc(centerX, centerY - 20, 8, Math.PI, Math.PI * 2);
                ctx.fill();
                
                // å°è¾«å­
                ctx.fillStyle = '#8D6E63';
                ctx.fillRect(centerX - 12, centerY - 18, 4, 8);
                ctx.fillRect(centerX + 8, centerY - 18, 4, 8);
                
                // å‘é¥°
                ctx.fillStyle = '#FF4081';
                ctx.beginPath();
                ctx.arc(centerX - 10, centerY - 22, 2, 0, Math.PI * 2);
                ctx.arc(centerX + 10, centerY - 22, 2, 0, Math.PI * 2);
                ctx.fill();

                if (isAfraid) {
                    // å®³æ€•çš„è¡¨æƒ…
                    ctx.fillStyle = '#000';
                    ctx.beginPath();
                    ctx.arc(centerX - 4, centerY - 18, 2, 0, Math.PI * 2);
                    ctx.arc(centerX + 4, centerY - 18, 2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // çœ¼æ³ª
                    ctx.fillStyle = '#2196F3';
                    ctx.fillRect(centerX - 5, centerY - 14, 2, 6);
                    ctx.fillRect(centerX + 3, centerY - 14, 2, 6);
                    
                    // é¢¤æŠ–çº¿æ¡
                    ctx.strokeStyle = '#FFC107';
                    ctx.lineWidth = 1;
                    for (let i = 0; i < 3; i++) {
                        ctx.beginPath();
                        ctx.moveTo(centerX - 15 + i * 10, centerY - 30);
                        ctx.lineTo(centerX - 13 + i * 10, centerY - 32);
                        ctx.stroke();
                    }
                } else {
                    // æ­£å¸¸è¡¨æƒ…
                    ctx.fillStyle = '#000';
                    ctx.fillRect(centerX - 5, centerY - 19, 2, 2);
                    ctx.fillRect(centerX + 3, centerY - 19, 2, 2);
                    
                    // å¾®ç¬‘
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY - 14, 3, 0, Math.PI);
                    ctx.stroke();
                }
                
                // æ‰‹è‡‚
                ctx.fillStyle = '#FFDBCB';
                ctx.fillRect(centerX - 15, centerY + 2, 5, 15);
                ctx.fillRect(centerX + 10, centerY + 2, 5, 15);
                
                // è…¿éƒ¨
                ctx.fillStyle = '#FF4081';
                ctx.fillRect(centerX - 6, centerY + 30, 5, 18);
                ctx.fillRect(centerX + 1, centerY + 30, 5, 18);
                
                // å°é‹å­
                ctx.fillStyle = '#9C27B0';
                ctx.fillRect(centerX - 8, centerY + 46, 8, 5);
                ctx.fillRect(centerX, centerY + 46, 8, 5);

                // å¦‚æœçˆ¶äº²æ­»äº†ä¸”å­©å­å®³æ€•ï¼Œæ˜¾ç¤ºä¿æŠ¤å…‰ç¯
                if (!gameState.fatherAlive && isAfraid) {
                    this.renderProtectionAura(ctx, centerX, centerY);
                }
            }

            /**
             * æ¸²æŸ“ä¿æŠ¤å…‰ç¯æ•ˆæœ
             * @param {CanvasRenderingContext2D} ctx - ç”»å¸ƒä¸Šä¸‹æ–‡
             * @param {number} centerX - ä¸­å¿ƒXåæ ‡
             * @param {number} centerY - ä¸­å¿ƒYåæ ‡
             */
            renderProtectionAura(ctx, centerX, centerY) {
                const time = Date.now() * 0.005;
                
                // å¤–å±‚å…‰ç¯
                ctx.strokeStyle = `rgba(255, 193, 7, ${0.3 + Math.sin(time) * 0.2})`;
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 35 + Math.sin(time * 2) * 5, 0, Math.PI * 2);
                ctx.stroke();
                
                // å†…å±‚å…‰ç¯
                ctx.strokeStyle = `rgba(255, 255, 255, ${0.5 + Math.sin(time * 1.5) * 0.3})`;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 25 + Math.sin(time * 3) * 3, 0, Math.PI * 2);
                ctx.stroke();
            }

            /**
             * å¢åŠ ææƒ§ç­‰çº§
             * @param {number} amount - å¢åŠ çš„ææƒ§å€¼
             */
            increaseFear(amount) {
                this.fearLevel = Math.min(this.maxFear, this.fearLevel + amount);
            }

            /**
             * å‡å°‘ææƒ§ç­‰çº§
             * @param {number} amount - å‡å°‘çš„ææƒ§å€¼
             */
            decreaseFear(amount) {
                this.fearLevel = Math.max(0, this.fearLevel - amount);
            }
        }

        // å¹³å°ç±»
        class Platform {
            constructor(x, y, width = GAME_CONFIG.PLATFORM_WIDTH, height = GAME_CONFIG.PLATFORM_HEIGHT) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.isTarget = false;
            }

            /**
             * æ¸²æŸ“å¹³å°
             * @param {CanvasRenderingContext2D} ctx - ç”»å¸ƒä¸Šä¸‹æ–‡
             */
            render(ctx) {
                // å¹³å°ä¸»ä½“
                ctx.fillStyle = this.isTarget ? '#4CAF50' : '#8D6E63';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // å¹³å°è¾¹æ¡†
                ctx.strokeStyle = '#5D4037';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.width, this.height);
                
                // å¹³å°çº¹ç†
                ctx.fillStyle = this.isTarget ? '#66BB6A' : '#A1887F';
                for (let i = 0; i < this.width; i += 10) {
                    ctx.fillRect(this.x + i, this.y + 2, 8, 2);
                }

                // ç›®æ ‡å¹³å°æ ‡è¯†
                if (this.isTarget) {
                    ctx.font = '20px Arial';
                    ctx.fillStyle = '#FFF';
                    ctx.textAlign = 'center';
                    ctx.fillText('ğŸ¯', this.x + this.width/2, this.y - 5);
                }
            }

            /**
             * æ£€æŸ¥è§’è‰²æ˜¯å¦åœ¨å¹³å°ä¸Š
             * @param {Character} character - è¦æ£€æŸ¥çš„è§’è‰²
             * @returns {boolean} æ˜¯å¦åœ¨å¹³å°ä¸Š
             */
            isCharacterOn(character) {
                return character.x >= this.x && 
                       character.x <= this.x + this.width &&
                       character.y >= this.y - 5 &&
                       character.y <= this.y + this.height + 5;
            }
        }

        // æ¸¸æˆä¸»ç±»
        class FatherJumpGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.platforms = [];
                this.currentPlatformIndex = 0;
                this.cameraX = 0;
                
                this.initializeGame();
                this.setupEventListeners();
                this.gameLoop();
            }

            /**
             * åˆå§‹åŒ–æ¸¸æˆ
             */
            initializeGame() {
                // åˆ›å»ºè§’è‰²
                this.father = new Father(100, 400);
                this.child = new Child(70, 400);
                
                // åˆ›å»ºåˆå§‹å¹³å°
                this.generateInitialPlatforms();
                
                // è®¾ç½®è§’è‰²åœ¨ç¬¬ä¸€ä¸ªå¹³å°ä¸Š
                this.father.onGround = true;
                this.child.onGround = true;
                this.father.y = this.platforms[0].y;
                this.child.y = this.platforms[0].y;
            }

            /**
             * ç”Ÿæˆåˆå§‹å¹³å°
             */
            generateInitialPlatforms() {
                this.platforms = [];
                
                // èµ·å§‹å¹³å°
                this.platforms.push(new Platform(50, 450, 100, 20));
                
                // ç”Ÿæˆåç»­å¹³å°
                for (let i = 1; i < 10; i++) {
                    this.generateNextPlatform();
                }
                
                // è®¾ç½®ç¬¬äºŒä¸ªå¹³å°ä¸ºç›®æ ‡
                this.platforms[1].isTarget = true;
            }

            /**
             * ç”Ÿæˆä¸‹ä¸€ä¸ªå¹³å°
             */
            generateNextPlatform() {
                const lastPlatform = this.platforms[this.platforms.length - 1];
                const distanceMultiplier = gameState.fatherAlive ? 
                    GAME_CONFIG.FATHER_ALIVE_DISTANCE_MULTIPLIER : 
                    GAME_CONFIG.FATHER_DEAD_DISTANCE_MULTIPLIER;
                
                const minDistance = GAME_CONFIG.MIN_PLATFORM_DISTANCE * distanceMultiplier;
                const maxDistance = GAME_CONFIG.MAX_PLATFORM_DISTANCE * distanceMultiplier;
                const distance = minDistance + Math.random() * (maxDistance - minDistance);
                
                const newX = lastPlatform.x + lastPlatform.width + distance;
                const newY = 400 + (Math.random() - 0.5) * 100;
                
                this.platforms.push(new Platform(newX, newY));
            }

            /**
             * è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
             */
            setupEventListeners() {
                // é¼ æ ‡/è§¦æ‘¸äº‹ä»¶
                this.canvas.addEventListener('mousedown', this.startCharging.bind(this));
                this.canvas.addEventListener('mouseup', this.jump.bind(this));
                this.canvas.addEventListener('touchstart', this.startCharging.bind(this));
                this.canvas.addEventListener('touchend', this.jump.bind(this));
                
                // é”®ç›˜äº‹ä»¶
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.startCharging();
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.jump();
                    }
                });

                // é˜²æ­¢é»˜è®¤è§¦æ‘¸è¡Œä¸º
                this.canvas.addEventListener('touchmove', (e) => e.preventDefault());
            }

            /**
             * å¼€å§‹è“„åŠ›
             */
            startCharging() {
                if (!gameState.gameRunning) return;
                
                gameState.charging = true;
                gameState.jumpPower = 0;
                document.getElementById('powerBar').style.display = 'block';
            }

            /**
             * æ‰§è¡Œè·³è·ƒ
             */
            jump() {
                if (!gameState.gameRunning || !gameState.charging) return;
                
                gameState.charging = false;
                document.getElementById('powerBar').style.display = 'none';
                
                // æ ¹æ®å½“å‰è·³è·ƒè€…æ‰§è¡Œè·³è·ƒ
                if (gameState.currentJumper === 'father' && this.father.alive) {
                    this.father.jump(gameState.jumpPower);
                    // å¦‚æœçˆ¶äº²è·³è·ƒï¼Œå­©å­ä¹Ÿè·Ÿç€è·³
                    this.child.jump(gameState.jumpPower * 0.9);
                } else if (gameState.currentJumper === 'child') {
                    this.child.jump(gameState.jumpPower);
                }
                
                gameState.jumpPower = 0;
            }

            /**
             * æ›´æ–°æ¸¸æˆé€»è¾‘
             */
            update() {
                if (!gameState.gameRunning) return;

                // æ›´æ–°è“„åŠ›
                if (gameState.charging) {
                    gameState.jumpPower = Math.min(GAME_CONFIG.MAX_JUMP_POWER, 
                        gameState.jumpPower + GAME_CONFIG.POWER_CHARGE_SPEED);
                    this.updatePowerBar();
                }

                // æ›´æ–°è§’è‰²
                if (this.father.alive) {
                    this.father.update();
                    this.checkFatherCollisions();
                }
                
                this.child.update();
                this.checkChildCollisions();

                // æ›´æ–°æ‘„åƒæœº
                this.updateCamera();

                // æ£€æŸ¥æ˜¯å¦éœ€è¦ç”Ÿæˆæ–°å¹³å°
                this.checkPlatformGeneration();

                // æ›´æ–°å­©å­çš„ææƒ§ç­‰çº§
                if (!gameState.fatherAlive) {
                    this.child.increaseFear(0.1);
                }
            }

            /**
             * æ›´æ–°è“„åŠ›æ¡æ˜¾ç¤º
             */
            updatePowerBar() {
                const powerPercent = (gameState.jumpPower / GAME_CONFIG.MAX_JUMP_POWER) * 100;
                document.getElementById('powerFill').style.height = powerPercent + '%';
            }

            /**
             * æ£€æŸ¥çˆ¶äº²ç¢°æ’
             */
            checkFatherCollisions() {
                this.father.onGround = false;
                
                for (let platform of this.platforms) {
                    if (platform.isCharacterOn(this.father)) {
                        this.father.y = platform.y;
                        this.father.velocityY = 0;
                        this.father.onGround = true;
                        this.father.isJumping = false;
                        
                        // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç›®æ ‡å¹³å°
                        if (platform.isTarget) {
                            this.handleSuccessfulJump(platform);
                        }
                        break;
                    }
                }

                // æ£€æŸ¥æ˜¯å¦æ‰è½
                if (this.father.y > GAME_CONFIG.CANVAS_HEIGHT + 100) {
                    this.handleFatherFall();
                }
            }

            /**
             * æ£€æŸ¥å­©å­ç¢°æ’
             */
            checkChildCollisions() {
                this.child.onGround = false;
                
                for (let platform of this.platforms) {
                    if (platform.isCharacterOn(this.child)) {
                        this.child.y = platform.y;
                        this.child.velocityY = 0;
                        this.child.onGround = true;
                        this.child.isJumping = false;
                        
                        // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç›®æ ‡å¹³å°
                        if (platform.isTarget && !gameState.fatherAlive) {
                            this.handleSuccessfulJump(platform);
                        }
                        break;
                    }
                }

                // æ£€æŸ¥æ˜¯å¦æ‰è½
                if (this.child.y > GAME_CONFIG.CANVAS_HEIGHT + 100) {
                    this.handleGameOver();
                }
            }

            /**
             * å¤„ç†æˆåŠŸè·³è·ƒ
             * @param {Platform} platform - ç›®æ ‡å¹³å°
             */
            handleSuccessfulJump(platform) {
                // å¢åŠ åˆ†æ•°
                gameState.addScore(10);
                
                // ç§»é™¤ç›®æ ‡æ ‡è¯†
                platform.isTarget = false;
                
                // è®¾ç½®ä¸‹ä¸€ä¸ªå¹³å°ä¸ºç›®æ ‡
                this.currentPlatformIndex++;
                if (this.currentPlatformIndex + 1 < this.platforms.length) {
                    this.platforms[this.currentPlatformIndex + 1].isTarget = true;
                }
                
                // å‡å°‘å­©å­çš„ææƒ§
                this.child.decreaseFear(5);
            }

            /**
             * å¤„ç†çˆ¶äº²æ‰è½
             */
            handleFatherFall() {
                this.father.die();
                gameState.fatherDies();
                
                // å¢åŠ å­©å­çš„ææƒ§
                this.child.increaseFear(30);
                
                // é‡æ–°ç”Ÿæˆå¹³å°ï¼ˆè·ç¦»æ›´å¤§ï¼‰
                this.regeneratePlatforms();
            }

            /**
             * é‡æ–°ç”Ÿæˆå¹³å°ï¼ˆçˆ¶äº²æ­»åï¼‰
             */
            regeneratePlatforms() {
                // ä¿ç•™å½“å‰å¹³å°å’Œå‰å‡ ä¸ªå¹³å°
                const keepPlatforms = this.platforms.slice(0, this.currentPlatformIndex + 2);
                this.platforms = keepPlatforms;
                
                // ç”Ÿæˆæ–°çš„æ›´éš¾çš„å¹³å°
                for (let i = 0; i < 8; i++) {
                    this.generateNextPlatform();
                }
                
                // è®¾ç½®ä¸‹ä¸€ä¸ªå¹³å°ä¸ºç›®æ ‡
                if (this.currentPlatformIndex + 1 < this.platforms.length) {
                    this.platforms[this.currentPlatformIndex + 1].isTarget = true;
                }
            }

            /**
             * æ›´æ–°æ‘„åƒæœºä½ç½®
             */
            updateCamera() {
                const targetX = gameState.fatherAlive ? this.father.x : this.child.x;
                this.cameraX = targetX - GAME_CONFIG.CANVAS_WIDTH / 2;
            }

            /**
             * æ£€æŸ¥æ˜¯å¦éœ€è¦ç”Ÿæˆæ–°å¹³å°
             */
            checkPlatformGeneration() {
                const lastPlatform = this.platforms[this.platforms.length - 1];
                const targetX = gameState.fatherAlive ? this.father.x : this.child.x;
                
                if (lastPlatform.x < targetX + GAME_CONFIG.CANVAS_WIDTH) {
                    this.generateNextPlatform();
                }
            }

            /**
             * å¤„ç†æ¸¸æˆç»“æŸ
             */
            handleGameOver() {
                gameState.gameRunning = false;
                
                document.getElementById('finalScore').textContent = gameState.score;
                document.getElementById('gameOverTitle').textContent = 'æ¸¸æˆç»“æŸ';
                
                let message = '';
                if (gameState.fatherAlive) {
                    message = 'çˆ¶å­ä¸€èµ·åŠªåŠ›ï¼Œä½†è¿™æ¬¡æ²¡æœ‰æˆåŠŸã€‚å†è¯•ä¸€æ¬¡å§ï¼';
                } else {
                    message = `å­©å­ç‹¬è‡ªåšæŒäº† ${gameState.score} åˆ†ï¼çˆ¶çˆ±çš„åŠ›é‡æ°¸è¿œåœ¨å¿ƒä¸­ã€‚`;
                }
                
                document.getElementById('gameOverMessage').textContent = message;
                document.getElementById('gameOverScreen').style.display = 'flex';
            }

            /**
             * æ¸²æŸ“æ¸¸æˆç”»é¢
             */
            render() {
                // æ¸…ç©ºç”»å¸ƒ
                this.ctx.clearRect(0, 0, GAME_CONFIG.CANVAS_WIDTH, GAME_CONFIG.CANVAS_HEIGHT);
                
                // ä¿å­˜ä¸Šä¸‹æ–‡çŠ¶æ€
                this.ctx.save();
                
                // åº”ç”¨æ‘„åƒæœºå˜æ¢
                this.ctx.translate(-this.cameraX, 0);
                
                // æ¸²æŸ“èƒŒæ™¯
                this.renderBackground();
                
                // æ¸²æŸ“å¹³å°
                for (let platform of this.platforms) {
                    if (platform.x + platform.width > this.cameraX && 
                        platform.x < this.cameraX + GAME_CONFIG.CANVAS_WIDTH) {
                        platform.render(this.ctx);
                    }
                }
                
                // æ¸²æŸ“è§’è‰²
                if (this.father.alive) {
                    this.father.render(this.ctx);
                }
                this.child.render(this.ctx);
                
                // æ¢å¤ä¸Šä¸‹æ–‡çŠ¶æ€
                this.ctx.restore();
                
                // æ¸²æŸ“UIå…ƒç´ 
                this.renderUI();
            }

            /**
             * æ¸²æŸ“èƒŒæ™¯
             */
            renderBackground() {
                // å¤©ç©ºæ¸å˜
                const gradient = this.ctx.createLinearGradient(0, 0, 0, GAME_CONFIG.CANVAS_HEIGHT);
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(1, '#98FB98');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(this.cameraX, 0, GAME_CONFIG.CANVAS_WIDTH, GAME_CONFIG.CANVAS_HEIGHT);
                
                // äº‘æœµ
                this.renderClouds();
            }

            /**
             * æ¸²æŸ“äº‘æœµ
             */
            renderClouds() {
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                
                for (let i = 0; i < 5; i++) {
                    const x = this.cameraX + (i * 200) % (GAME_CONFIG.CANVAS_WIDTH + 200);
                    const y = 50 + (i * 30) % 100;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 20, 0, Math.PI * 2);
                    this.ctx.arc(x + 25, y, 25, 0, Math.PI * 2);
                    this.ctx.arc(x + 50, y, 20, 0, Math.PI * 2);
                    this.ctx.fill();
                }
            }

            /**
             * æ¸²æŸ“UIå…ƒç´ 
             */
            renderUI() {
                // å¦‚æœå­©å­å®³æ€•ï¼Œæ˜¾ç¤ºææƒ§ç­‰çº§
                if (this.child.fearLevel > 0) {
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    this.ctx.fillRect(10, GAME_CONFIG.CANVAS_HEIGHT - 60, 200, 20);
                    
                    this.ctx.fillStyle = this.child.fearLevel > 70 ? '#F44336' : 
                                        this.child.fearLevel > 40 ? '#FF9800' : '#FFC107';
                    this.ctx.fillRect(12, GAME_CONFIG.CANVAS_HEIGHT - 58, 
                        (this.child.fearLevel / 100) * 196, 16);
                    
                    this.ctx.fillStyle = '#FFF';
                    this.ctx.font = '12px Arial';
                    this.ctx.fillText(`å­©å­ææƒ§ç­‰çº§: ${Math.round(this.child.fearLevel)}%`, 
                        15, GAME_CONFIG.CANVAS_HEIGHT - 25);
                }
            }

            /**
             * æ¸¸æˆä¸»å¾ªç¯
             */
            gameLoop() {
                this.update();
                this.render();
                requestAnimationFrame(this.gameLoop.bind(this));
            }
        }

        // å…¨å±€å˜é‡
        let gameState;
        let game;

        /**
         * é‡æ–°å¼€å§‹æ¸¸æˆ
         */
        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            gameState.reset();
            game.initializeGame();
        }

        /**
         * åˆå§‹åŒ–æ¸¸æˆ
         */
        function initGame() {
            // è®¾ç½®CSSå˜é‡ä»¥è§£å†³ç§»åŠ¨ç«¯100vhé—®é¢˜
            const setVH = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            
            setVH();
            window.addEventListener('resize', setVH);

            // åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€å’Œæ¸¸æˆå®ä¾‹
            gameState = new GameState();
            game = new FatherJumpGame();
            
            // å¼€å§‹æ¸¸æˆ
            gameState.reset();
            
            console.log('çˆ¶çˆ±è·³ä¸€è·³æ¸¸æˆåˆå§‹åŒ–å®Œæˆï¼');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html> 